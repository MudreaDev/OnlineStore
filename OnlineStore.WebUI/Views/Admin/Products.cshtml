@model IEnumerable<OnlineStore.Domain.Entities.Product>
@using OnlineStore.Domain.Entities

@{
    ViewData["Title"] = "Inventory Management";
}

<style>
    .admin-page {
        padding-top: 2rem;
        padding-bottom: 5rem;
    }

    .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 3rem;
    }

    .admin-title {
        font-family: var(--font-display);
        font-size: 2.25rem;
        font-weight: 800;
        color: var(--midnight);
        letter-spacing: -0.02em;
    }

    .btn-create {
        background: var(--midnight);
        color: #fff;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        text-decoration: none;
        font-family: var(--font-display);
        font-weight: 700;
        font-size: 0.875rem;
        transition: var(--transition-smooth);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: var(--shadow-sm);
    }

    .btn-create:hover {
        background: var(--accent-primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    /* --- Refined Table Card --- */
    .inventory-card {
        background: #fff;
        border: 1px solid var(--border-subtle);
        border-radius: 24px;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
    }

    .inventory-table {
        width: 100%;
        border-collapse: collapse;
    }

    .inventory-table thead {
        background: var(--bg-base);
        border-bottom: 1px solid var(--border-subtle);
    }

    .inventory-table th {
        padding: 1.25rem 1.5rem;
        text-align: left;
        font-size: 0.65rem;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--text-muted);
        letter-spacing: 0.1em;
    }

    .inventory-table td {
        padding: 1.25rem 1.5rem;
        font-size: 0.875rem;
        color: var(--text-main);
        border-bottom: 1px solid var(--border-subtle);
        vertical-align: middle;
    }

    .inventory-table tr:last-child td {
        border-bottom: none;
    }

    .inventory-table tbody tr:hover {
        background: var(--bg-base);
    }

    .item-name {
        font-weight: 700;
        color: var(--midnight);
        font-family: var(--font-display);
    }

    /* Badges */
    .admin-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 8px;
        font-size: 0.65rem;
        font-weight: 800;
        letter-spacing: 0.05em;
        text-transform: uppercase;
    }

    .badge-electro {
        background: #ecfdf5;
        color: #065f46;
    }

    .badge-clothing {
        background: #fdf4ff;
        color: #7e22ce;
    }

    .badge-vehicle {
        background: #fff7ed;
        color: #c2410c;
    }

    .badge-neutral {
        background: var(--bg-base);
        color: var(--text-muted);
    }

    .stock-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 700;
        font-size: 0.8125rem;
    }

    .stock-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    /* Row Actions */
    .action-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-icon-action {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--border-subtle);
        background: #fff;
        color: var(--text-muted);
        transition: var(--transition-smooth);
        cursor: pointer;
        text-decoration: none;
    }

    .btn-icon-action:hover {
        border-color: var(--accent-primary);
        color: var(--accent-primary);
        background: var(--bg-base);
    }

    .btn-delete-row:hover {
        border-color: #fca5a5;
        color: #dc2626;
        background: #fef2f2;
    }

    .pagination-wrap {
        margin-top: 3rem;
        display: flex;
        justify-content: center;
        gap: 0.5rem;
    }

    .admin-page-link {
        padding: 0.6rem 1rem;
        border-radius: 10px;
        border: 1px solid var(--border-subtle);
        color: var(--text-main);
        font-weight: 700;
        text-decoration: none;
        transition: var(--transition-smooth);
        font-size: 0.8125rem;
    }

    .admin-page-link:hover {
        border-color: var(--accent-primary);
        color: var(--accent-primary);
    }

    .admin-page-link.active {
        background: var(--midnight);
        color: #fff;
        border-color: var(--midnight);
    }
</style>

<div class="container admin-page fade-in">
    <div class="page-header">
        <h1 class="admin-title">Inventory <span style="font-weight: 300; opacity: 0.5;">Manage</span></h1>
        <a asp-action="AddProduct" class="btn-create">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create New Product
        </a>
    </div>

    <div class="inventory-card">
        @if (!Model.Any())
        {
            <div style="text-align: center; padding: 6rem 2rem;">
                <div style="font-size: 3rem; margin-bottom: 1.5rem; opacity: 0.3;">üóÉÔ∏è</div>
                <h4 style="font-family: var(--font-display); color: var(--midnight);">No inventory items</h4>
                <p style="color: var(--text-muted); font-size: 0.875rem;">Your digital warehouse is currently empty.</p>
            </div>
        }
        else
        {
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Product Details</th>
                        <th>Type</th>
                        <th>Price</th>
                        <th>Shipment Stock</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var product in Model)
                    {
                        <tr>
                            <td>
                                <div class="item-name">@product.Name</div>
                                <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.25rem;">
                                    @if (product is ElectronicProduct electro)
                                    {
                                        <span>Protection: @electro.WarrantyMonths Months</span>
                                    }
                                    else if (product is ClothingProduct clothing)
                                    {
                                        <span>Size: @clothing.Size | @clothing.Material</span>
                                    }
                                    else if (product is VehicleProduct vehicle)
                                    {
                                        <span>@vehicle.Brand @vehicle.Model (@vehicle.Year)</span>
                                    }
                                    else
                                    {
                                        <span>ID: @product.Id.ToString().Substring(0, 8)</span>
                                    }
                                </div>
                            </td>
                            <td>
                                @{
                                    var typeName = product.GetType().Name.Replace("Product", "");
                                    var badgeClass = typeName switch
                                    {
                                        "Electronic" => "badge-electro",
                                        "Clothing" => "badge-clothing",
                                        "Vehicle" => "badge-vehicle",
                                        _ => "badge-neutral"
                                    };
                                }
                                <span class="admin-badge @badgeClass">@typeName</span>
                            </td>
                            <td style="font-weight: 700; color: var(--midnight);">@product.Price.ToString("C0")</td>
                            <td>
                                <div class="stock-indicator"
                                    style="color: @(product.Stock > 0 ? "var(--accent-primary)" : "#dc2626")">
                                    <div class="stock-dot"
                                        style="background: @(product.Stock > 0 ? "var(--accent-primary)" : "#dc2626")"></div>
                                    @product.Stock units
                                </div>
                            </td>
                            <td>
                                <div class="action-group">
                                    <a asp-action="EditProduct" asp-route-id="@product.Id" class="btn-icon-action" title="Edit">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="2.5">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                    </a>
                                    <form asp-action="CloneProduct" asp-route-id="@product.Id" method="post">
                                        <button type="submit" class="btn-icon-action" title="Clone">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2.5">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                    </form>
                                    <form asp-action="DeleteProduct" asp-route-id="@product.Id" method="post"
                                        onsubmit="return confirm('Archive \'@product.Name\'?')">
                                        <button type="submit" class="btn-icon-action btn-delete-row" title="Delete">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2.5">
                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                <path
                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                </path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>

    @if (ViewBag.TotalPages > 1)
    {
        <div class="pagination-wrap">
            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                <a asp-action="Products" asp-route-page="@i"
                    class="admin-page-link @(ViewBag.CurrentPage == i ? "active" : "")">@i</a>
            }
        </div>
    }
</div>
